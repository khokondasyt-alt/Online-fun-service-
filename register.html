<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Register - Online Fun Service</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
<style>
body {
  font-family:'Poppins',sans-serif;
  background: linear-gradient(180deg, #fddb92, #fff176);
  color:#00008B;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
  margin:0;
}
.container {
  background: rgba(255,255,255,0.3);
  padding:30px;
  border-radius:15px;
  width:340px;
  text-align:center;
  box-shadow:0 5px 15px rgba(0,0,0,0.3);
}
input,select {
  width:100%;
  padding:10px;
  margin:8px 0;
  border:none;
  border-radius:8px;
}
button {
  width:100%;
  padding:10px;
  margin-top:15px;
  border:none;
  border-radius:8px;
  background:#00008B;
  color:white;
  font-weight:600;
  cursor:pointer;
}
.error{color:red;font-size:13px;margin-top:3px;}
a {
  display:block;
  margin-top:10px;
  color:#00008B;
  text-decoration:none;
  font-weight:600;
}
a:hover {
  text-decoration:underline;
}
</style>
</head>
<body>
<div class="container">
  <h2>Register</h2>
  <input type="text" id="fullname" placeholder="Full Name">
  <div id="fullnameError" class="error"></div>

  <input type="text" id="mobile" placeholder="Mobile Number (10 digits)" maxlength="10">
  <div id="mobileError" class="error"></div>

  <input type="email" id="email" placeholder="Email (Optional)">
  <input type="password" id="password" placeholder="Password">
  <div id="passwordError" class="error"></div>

  <select id="gender">
    <option value="">Select Gender</option>
    <option value="Male">Male</option>
    <option value="Female">Female</option>
  </select>
  <div id="genderError" class="error"></div>

  <input type="file" id="profilePhoto" accept="image/*">
  <button onclick="register()">Register</button>

  <!-- ‡¶∂‡ßÅ‡¶ß‡ßÅ ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶°‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø -->
  <a href="#" onclick="downloadApp()">Already have an account? Login</a>
</div>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-storage.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyCKeFUWUchjQtDo9gxrSSJvMaK9lUAigBk",
  authDomain: "puja-fun.firebaseapp.com",
  databaseURL: "https://puja-fun-default-rtdb.firebaseio.com",
  projectId: "puja-fun",
  storageBucket: "puja-fun.appspot.com",
  messagingSenderId: "85559207543",
  appId: "1:85559207543:web:0a280345399932b3da4872"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const storage = firebase.storage();

function generateUID(){
  return "OFS" + Math.floor(100000 + Math.random() * 900000);
}

function register(){
  document.getElementById("fullnameError").innerText="";
  document.getElementById("mobileError").innerText="";
  document.getElementById("passwordError").innerText="";
  document.getElementById("genderError").innerText="";

  const fullname=document.getElementById("fullname").value.trim();
  const mobile=document.getElementById("mobile").value.trim();
  const email=document.getElementById("email").value.trim();
  const password=document.getElementById("password").value.trim();
  const gender=document.getElementById("gender").value;
  const profileFile=document.getElementById("profilePhoto").files[0];

  let valid=true;
  if(!fullname){document.getElementById("fullnameError").innerText="Full Name required";valid=false;}
  if(!password){document.getElementById("passwordError").innerText="Password required";valid=false;}
  if(!gender){document.getElementById("genderError").innerText="Select Gender";valid=false;}
  if(!/^\d{10}$/.test(mobile)){document.getElementById("mobileError").innerText="Enter valid 10-digit mobile";valid=false;}
  if(!valid) return;

  db.ref("users").orderByChild("mobile").equalTo(mobile).once("value",snapshot=>{
    if(snapshot.exists()){
      alert("This mobile number is already registered!");
      return;
    } else {
      let uid = generateUID();
      db.ref("users/"+uid).once("value",snap=>{
        if(snap.exists()){ uid = generateUID(); }

        const role = gender==="Female" ? "model" : "user";
        const accountStatus = gender==="Female" ? "pending" : "active";

        const userData = {
          uid,
          fullname,
          email,
          password,
          gender,
          mobile,
          role,
          accountStatus,
          wallet: 0
        };

        const saveUser = ()=>{
          db.ref("users/"+uid).set(userData)
            .then(()=>{
              alert("‚úÖ Registration Successful! Your app will download automatically...");
              const link = document.createElement('a');
              link.href = 'https://github.com/khokondasyt-alt/Online-fun-service-/raw/main/onlinefunservice.apk';
              link.download = 'OnlineFunService.apk';
              document.body.appendChild(link);
              link.click();
              document.body.removeChild(link);
            })
            .catch(err=>alert("Error: "+err.message));
        };

        if(profileFile){
          const ref = storage.ref("profiles/"+uid+".jpg");
          ref.put(profileFile).then(snap=>snap.ref.getDownloadURL())
            .then(url=>{
              userData.profilePic = url;
              saveUser();
            })
            .catch(err=>alert("Photo upload failed: "+err.message));
        } else {
          saveUser();
        }
      });
    }
  });
}

// ‚úÖ ‡¶∂‡ßÅ‡¶ß‡ßÅ ‚ÄúAlready have an account? Login‚Äù ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡¶≤‡ßá ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶° ‡¶π‡¶¨‡ßá
function downloadApp(){
  alert("üì• Downloading Online Fun Service App...");
  const link = document.createElement('a');
  link.href = 'https://github.com/khokondasyt-alt/Online-fun-service-/raw/main/onlinefunservice.apk';
  link.download = 'OnlineFunService.apk';
  document.body.appendChild(link);
  link.click();
  document.body.removeChild(link);
}
</script>
</body>
</html>